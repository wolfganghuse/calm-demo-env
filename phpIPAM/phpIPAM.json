{"status":{},"contains_secrets":true,"product_version":"3.2.0","spec":{"description":"Create phpIPAM 1.4 from Scratch\nDefault Login: admin\/ipamadmin","resources":{"client_attrs":{},"service_definition_list":[{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Service1"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"3fc43338_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"7d5eddd4_runbook","main_task_local_reference":{"kind":"app_task","name":"3fc43338_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Service1"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"a200fcf8_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"b3b1e669_runbook","main_task_local_reference":{"kind":"app_task","name":"a200fcf8_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Service1"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"fea3edbf_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"0938823c_runbook","main_task_local_reference":{"kind":"app_task","name":"fea3edbf_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Service1"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"e3cd3f21_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"b7be7476_runbook","main_task_local_reference":{"kind":"app_task","name":"e3cd3f21_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Service1"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"48aa312a_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"f991b1eb_runbook","main_task_local_reference":{"kind":"app_task","name":"48aa312a_dag"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[],"name":"Service1","port_list":[],"tier":"","variable_list":[],"description":""}],"substrate_definition_list":[{"description":"","action_list":[{"description":"","type":"fragment","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"svc_phpIPAM"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"c5e15f7d_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"3782912b_runbook","main_task_local_reference":{"kind":"app_task","name":"c5e15f7d_dag"},"variable_list":[]},"name":"pre_action_create"},{"description":"","type":"fragment","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"svc_phpIPAM"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"b2b773f6_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"96574c92_runbook","main_task_local_reference":{"kind":"app_task","name":"b2b773f6_dag"},"variable_list":[]},"name":"post_action_delete"}],"type":"AHV_VM","name":"svc_phpIPAM","readiness_probe":{"connection_type":"SSH","retries":"5","connection_protocol":"","connection_port":22,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"60","disable_readiness_probe":true,"login_credential_local_reference":{"kind":"app_credential","name":"cred_os"}},"editables":{"create_spec":{"resources":{"nic_list":{},"serial_port_list":{}}}},"os_type":"Linux","create_spec":{"name":"vm-@@{calm_time}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"64cf3bea-fc2f-4827-9ef6-fd1bce2ef86f"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":2,"gpu_list":[],"memory_size_mib":4096,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nusers:\n  - name: centos\n    ssh-authorized-keys:\n      - @@{cred_os.public_key}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']"},"type":"","sysprep":null},"power_state":"ON","type":"","account_uuid":"8c4f7de3-544f-426d-98a2-40986fb657e4","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","boot_type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"image","type":"","name":"CentOS7","uuid":"c7edd112-7b4a-42db-ba9a-0df17223857e"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]}],"credential_definition_list":[{"username":"centos","description":"","type":"KEY","secret":{"attrs":{"is_secret_modified":true,"secret_reference":{}},"value":"qXtoPy80Gger3xJIHtT4ZJp7aw6FBXAnfFZKT28tcX6MlfECyv+Abhshw806K\/axY\/EGlSS63IyfaXa2NEvQjeHRFcbPV+9O+QT5q8WlCatOE7a30AYNNfIi4ljck4B8qk54rPO1r3H+\/m1me+F3YwrOS\/qPgC3drVyKRCsaXUPWFASAnUZByk3M3khKw6UCepTiMy+YA8s7Eh4P9k6ydFCsISTzuaWadFjOeqNeO2xzd2Ha45bdxB7AyjoZ4jiS14irOSfqZgLoZKp13eXkTo3hDwQnLdylvPYyhKRgWK9L1bERXrRc3C3p1AqL2qgFxLPrkQMjWJ\/I5C1GE5IEgQ4eRwKKRYcULlbxkP5Jv74dDe27I6uj8dTTjlk\/O8F3HGf7nSEle5NDUj98JnnXO5KCSr\/ov2zU8peOtquOS2Y9VmWpCnq5L\/f22QWnYBO94qNYn35IuX9Zg3hPKwY+QxCisBbOnL3cbCK68\/vZPKEaNkFdUcnM8wwZTslyEM8JEFdIWDPd40EzHXHIJ9vNZeuROHhxjo+w2O7VBoiwvN8rRNHH1agwMtBSPtq+GfTxydx6AeuolXoaUj4JA0+ZAZW4r6wp8P\/Hd+a2nwBu147g4yCa6iQoVchO+9SaLgKnfoEcgATH+eacGQADoOTzBMLkHW4PGkTRNWtDLM4TfRoHC9wmH3ujqyXb5D7qvbQOraRBT8en2MWphQQf\/xP1AlKG+3yz8uuEpEXt3JkvKamCPOUu3HoYtm4qPnjad5spa9kKAS6sNIcdj79nZwnRonqlwZNheamwSY4kz80Apzyne4oN59Nl9NxZMx7DiDWiXY9niLXwMwrxYxyxTTGEifWLnNOMajmL36XhfIVxuoTQ1h8jKCct35qm86qZoNiuTToRbIveUXpg7sHAIKkc+f7qotkpxIp3MFKkMZPftt2lXfv3cv8wK9b9Mu4mpgtPVYZRPiGriJO8cwhCE\/UQAT+hvd062\/b7KxFypyKDxWDYqaxE1CEIj8pD6r9vGJlF7dWUQu4SxbzhTZbemEGNUlF80DnZzYiTv0glGKCOyFoxWY0caYWWc3x1HfZhOoy9fBW3JtJamYPdDLRo61hX4SqBeBHKk+V9n5Vwa3Wf1TTLIAWD3OMxiJLwwVvaW0zNFYuDiUIIoG6VLxutIFc8OeMompyrLIxTnmaj96IGe4ez6JWwowGfjPjt7tT7O3gh+qoFpW78rm53pnK5V40dAlzD1yq2GNWo+fJ13tMNDOX7lwZ0sOcQdoAR07HVad3OGFlT+CuRTU8bCy0yBzyaLntZW1pOM\/MHoPOQVwwy1FLO9Shcx4SK5Dsx9J1PDpN8gf77Aq9KFL8i00fgcD84KXMsSM0AKFDlHgDk4OsFC1JqVxC0Dbx7yDASefcbk+gu3MYTz5zZJ+j7YawcmNBKKCvjYyNGBSFV9HRsYJkg3O12VnEY8TaYmVckB29EG6rOnpKJtX8odyJCKKLuvP104eawXmQHXOAtowITS9a28fMdA6HzTS4tcJnlIrkn9Q7y\/TWoPLQx5mquO1zYUICKUHuS+2IEMxwJP9rShxLG7iYzriptAgOzGMNT8YptjZCPhgTADm9X3mUSx0yEQ3GqkIbjUm5CPiWvyN23UEpkQOB0H47U2HpmAi5mrWO\/aaQtiK6yqU4B8LodM4wYkTC+A1B2DGWuIJM8a7C0l3rZqNzKC1+X9M8PTa0d11nRpNV1BdYvmMxzEjE4gGiaXEvC2yBVTl56jexx3nQrjjKu87VsVZ\/FK6srVhCs7PTbQ6uGPweMoUNhusk5VqeWiWWWq4mlez3nfUxC+6LjavaLjiomEnrFdSeP9nNfKATB4P+MDuB3\/SN6zR15Q53cEB5f35o+FAalocA1S7k\/us5\/+gZtOCGv9jgdWnut4yWkF51HpmE6hCjNFjnZcMWJTVw2QKwkCTW47xckHXN2Nc4+o8u6h21tWan10hpiQAQguvRzN8h+g\/hPbmAzG2rzSdva16l07S+3mUqzo1WQKeMqDAAQnoQhysJjBWvzU1s1YXWT3UCaUCBbCr2lKTqbQJYgR1yDt0eCYrmB0D\/KU+RnFeVd8A53Leq\/bmIyC\/H8LJDuArGhmK8wxea76eSYAhkEO6BTZFl3EEg2s6ox3xvUqTV+CdYVEcKcUTZzbSvUQtO1ZUKwviycuw2H5pvbEYUfsZe+8lfMfTdCtze+GUb0eGNciYJo33CEnNAZDofHYRRjTeDCcheXXJakbwyEEUYytMwFdTAGq999wwcWO8C6:utf-8"},"name":"cred_os"}],"package_definition_list":[{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"Service1"}],"name":"Package1","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Package1"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Install_Packages"},{"kind":"app_task","name":"Config_httpd"},{"kind":"app_task","name":"Enable_Services"},{"kind":"app_task","name":"Config_phpIPAM"},{"kind":"app_task","name":"Enable_SSL"},{"kind":"app_task","name":"Create_Database"}],"name":"286a38ce_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Install_Packages"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Config_httpd"}},{"from_task_reference":{"kind":"app_task","name":"Config_httpd"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Enable_Services"}},{"from_task_reference":{"kind":"app_task","name":"Enable_Services"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Config_phpIPAM"}},{"from_task_reference":{"kind":"app_task","name":"Config_phpIPAM"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Enable_SSL"}},{"from_task_reference":{"kind":"app_task","name":"Enable_SSL"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Create_Database"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Service1"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Install_Packages","attrs":{"script":"sudo yum -y install httpd mariadb-server php php-cli php-gd php-common php-ldap php-pdo php-pear php-snmp php-xml php-mysql php-mbstring git \nsudo yum -y install epel-release \nsudo yum -y install php-mcrypt\n","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Service1"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Config_httpd","attrs":{"script":"echo 'ServerRoot \"\/etc\/httpd\"\nListen 80\nInclude conf.modules.d\/*.conf\nUser apache\nGroup apache\nServerAdmin root@localhost\nServerName localhost:80\n<Directory \/>\n    AllowOverride none\n    Require all denied\n<\/Directory>\nDocumentRoot \"\/var\/www\/html\"\n<Directory \"\/var\/www\">\n    AllowOverride None\n    # Allow open access:\n    Require all granted\n<\/Directory>\n<Directory \"\/var\/www\/html\">\n    Options FollowSymLinks\n    AllowOverride all\n    Order allow,deny\n    Allow from all\n<\/Directory>\n<IfModule dir_module>\n    DirectoryIndex index.html\n<\/IfModule>\n<Files \".ht*\">\n    Require all denied\n<\/Files>\nErrorLog \"logs\/error_log\"\nLogLevel warn\n<IfModule log_config_module>\n    LogFormat \"%h %l %u %t \\\"%r\\\" %>s %b \\\"%{Referer}i\\\" \\\"%{User-Agent}i\\\"\" combined\n    LogFormat \"%h %l %u %t \\\"%r\\\" %>s %b\" common\n\n    <IfModule logio_module>\n      # You need to enable mod_logio.c to use %I and %O\n      LogFormat \"%h %l %u %t \\\"%r\\\" %>s %b \\\"%{Referer}i\\\" \\\"%{User-Agent}i\\\" %I %O\" combinedio\n    <\/IfModule>\n    CustomLog \"logs\/access_log\" combined\n<\/IfModule>\n\n<IfModule alias_module>\n    ScriptAlias \/cgi-bin\/ \"\/var\/www\/cgi-bin\/\"\n\n<\/IfModule>\n<Directory \"\/var\/www\/cgi-bin\">\n    AllowOverride None\n    Options None\n    Require all granted\n<\/Directory>\n\n<IfModule mime_module>\n    TypesConfig \/etc\/mime.types\n    AddType application\/x-compress .Z\n    AddType application\/x-gzip .gz .tgz\n    AddType text\/html .shtml\n    AddOutputFilter INCLUDES .shtml\n<\/IfModule>\nAddDefaultCharset UTF-8\n\n<IfModule mime_magic_module>\n    MIMEMagicFile conf\/magic\n<\/IfModule>\nEnableSendfile on\nIncludeOptional conf.d\/*.conf' | sudo tee \/etc\/httpd\/conf\/httpd.conf\n","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Service1"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Enable_Services","attrs":{"script":"sudo service httpd start\nsudo chkconfig httpd on\nsudo firewall-cmd --permanent --add-port=80\/tcp\nsudo service mariadb start\nsudo chkconfig mariadb on\nmysqladmin --user=root password \"@@{mariadb_rootpwd}@@\"\n","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Service1"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Config_phpIPAM","attrs":{"script":"cd \/var\/www\/html\/\nsudo git clone https:\/\/github.com\/phpipam\/phpipam.git .\nsudo git checkout 1.4\nsudo chown apache:apache -R \/var\/www\/html\/\nsudo chcon -t httpd_sys_content_t \/var\/www\/html\/ \u2013R\nsudo find . -type f -exec chmod 0644 {} \\;\nsudo find . -type d -exec chmod 0755 {} \\;\nsudo cp config.dist.php config.php","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Service1"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Enable_SSL","attrs":{"script":"sudo yum -y install mod_ssl\nsudo mkdir \/etc\/ssl\/private\nsudo chmod 700 \/etc\/ssl\/private\nsudo openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout \/etc\/ssl\/private\/apache-selfsigned.key -out \/etc\/ssl\/certs\/apache-selfsigned.crt -subj \"\/C=DE\/ST=NRW\/L=Dortmund\/O=Sales\/CN=phpipam\"\nsudo openssl dhparam -out \/etc\/ssl\/certs\/dhparam.pem 2048\ncat \/etc\/ssl\/certs\/dhparam.pem | sudo tee -a \/etc\/ssl\/certs\/apache-selfsigned.crt\nsudo sed -i 's\/SSLCertificateFile \\\/etc\\\/pki\\\/tls\\\/certs\\\/localhost.crt\/SSLCertificateFile \\\/etc\\\/ssl\\\/certs\\\/apache-selfsigned.crt\/g' \/etc\/httpd\/conf.d\/ssl.conf\nsudo sed -i 's\/SSLCertificateKeyFile \\\/etc\\\/pki\\\/tls\\\/private\\\/localhost.key\/SSLCertificateKeyFile \\\/etc\\\/ssl\\\/private\\\/apache-selfsigned.key\/g' \/etc\/httpd\/conf.d\/ssl.conf\nsudo sed -i 's\/#ServerName www.example.com:443\/ServerName phpipam:443\/g' \/etc\/httpd\/conf.d\/ssl.conf\nsudo systemctl restart httpd.service\n#sudo firewall-cmd --add-service=http\n#sudo firewall-cmd --add-service=https\n#sudo firewall-cmd --runtime-to-permanent","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Service1"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Create_Database","attrs":{"script":"cd \/var\/www\/html\necho \"create database \\`phpipam\\`;\" | sudo mysql -u root -p@@{mariadb_rootpwd}@@\nmysql -u root -p@@{mariadb_rootpwd}@@ phpipam < db\/SCHEMA.sql\necho \"GRANT ALL on \\`phpipam\\`.* to phpipam@localhost identified by 'phpipamadmin';;\" | sudo mysql -u root -p@@{mariadb_rootpwd}@@","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"cc380fa7_runbook","main_task_local_reference":{"kind":"app_task","name":"286a38ce_dag"},"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Package1"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"2deac6fa_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"53ad5cbf_runbook","main_task_local_reference":{"kind":"app_task","name":"2deac6fa_dag"},"variable_list":[]}},"variable_list":[]}],"app_profile_list":[{"deployment_create_list":[{"type":"GREENFIELD","action_list":[],"name":"98854c90_deployment","min_replicas":"1","default_replicas":"1","depends_on_list":[],"published_service_local_reference_list":[],"max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"Package1"}],"substrate_local_reference":{"kind":"app_substrate","name":"svc_phpIPAM"},"variable_list":[],"description":""}],"environment_reference_list":[],"description":"","action_list":[],"name":"Default","variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"mariadb_rootpwd","value":"Nutanix\/4u","label":"","attrs":{"type":"LOCAL"},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}}]}],"published_service_definition_list":[],"default_credential_local_reference":{"kind":"app_credential","name":"cred_os"},"type":"USER"},"name":"phpIPAM"},"api_version":"3.0","metadata":{"last_update_time":"1613666258409435","kind":"blueprint","spec_version":3,"creation_time":"1611141173385050","categories":{"TemplateType":"Vm"},"name":"phpIPAM"}}