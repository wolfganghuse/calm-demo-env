{"status":{},"contains_secrets":true,"product_version":"3.2.0","spec":{"description":"Basic Config f5 BigIP Virtual Edition, Single NIC","resources":{"client_attrs":{},"service_definition_list":[{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Service1"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"c98f54ea_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"12441b89_runbook","main_task_local_reference":{"kind":"app_task","name":"c98f54ea_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Service1"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"0a1d8b52_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"ad310079_runbook","main_task_local_reference":{"kind":"app_task","name":"0a1d8b52_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Service1"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"b4d5285c_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"c86f1350_runbook","main_task_local_reference":{"kind":"app_task","name":"b4d5285c_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Service1"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"3d94b9ca_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"bd5c961d_runbook","main_task_local_reference":{"kind":"app_task","name":"3d94b9ca_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Service1"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"7036bf35_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"240983e1_runbook","main_task_local_reference":{"kind":"app_task","name":"7036bf35_dag"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[],"name":"Service1","port_list":[],"tier":"","variable_list":[],"description":""}],"substrate_definition_list":[{"description":"","action_list":[],"type":"AHV_VM","name":"svcBigIP","readiness_probe":{"connection_type":"SSH","retries":"5","connection_protocol":"","connection_port":22,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"60","disable_readiness_probe":true},"editables":{"create_spec":{"resources":{"nic_list":{},"serial_port_list":{}}}},"os_type":"Linux","create_spec":{"name":"vm-@@{calm_time}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"64cf3bea-fc2f-4827-9ef6-fd1bce2ef86f"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":4,"gpu_list":[],"memory_size_mib":8192,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nchpasswd:\n  list: |\n    root:@@{root.secret}@@\n    admin:@@{admin.secret}@@\n  expire: False"},"type":"","sysprep":null},"power_state":"ON","type":"","account_uuid":"8c4f7de3-544f-426d-98a2-40986fb657e4","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","boot_type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"image","type":"","name":"BIGIP-15.1.0.5-0.0.8.qcow2","uuid":"8feac2d1-6f08-4fd9-ad96-19262a134de9"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]}],"credential_definition_list":[{"username":"admin","description":"","type":"PASSWORD","secret":{"attrs":{"is_secret_modified":true,"secret_reference":{}},"value":"LeoRaayLCwrhpzSGPdWgA8rrgl2ZSagUfnDnKueaM495P5Z795\/ZS0LT:utf-8"},"name":"admin","editables":{"secret":true}},{"username":"root","description":"","type":"PASSWORD","secret":{"attrs":{"is_secret_modified":true,"secret_reference":{}},"value":"W15eFc1XueSXxgtLjS7xOMRETCEUp0284jRbAvmIONa+TqYY2dOtU\/io:utf-8"},"name":"root","editables":{"secret":true}}],"package_definition_list":[{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"Service1"}],"name":"Package1","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Package1"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Install License"},{"kind":"app_task","name":"Install AS3"},{"kind":"app_task","name":"Create Runbook Endpoint"}],"name":"0a93e741_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Install License"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Install AS3"}},{"from_task_reference":{"kind":"app_task","name":"Install AS3"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Create Runbook Endpoint"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Service1"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Install License","attrs":{"exit_status":[],"script":"SOAPLicenseClient --basekey @@{License}@@","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"root"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Service1"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Install AS3","attrs":{"script":"#script\n\nprint (\"Downloading AS3 Extensions...\")\nas3 = urlreq(\"@@{AS3}@@\")\nas3size = len(as3.content)\nprint (\"%s Bytes downloaded.\" % as3size)\n\nprint (\"Uploading AS3 Extensions into BigIP...\")\nrange = \"0-{0}\/{1}\".format(as3size-1,as3size)\nheader = {\"Content-Type\": \"application\/octet-stream\",\"Content-Range\": range,\"Content-Length\": str(len(as3.content)),\"Connection\": \"keep-alive\"}\nupload = urlreq (\"https:\/\/@@{svcBigIP.address}@@:8443\/mgmt\/shared\/file-transfer\/uploads\/as3.rpm\",verb=\"POST\", headers=header, params=as3.content, auth=\"BASIC\", user=\"@@{admin.username}@@\", passwd=\"@@{admin.secret}@@\")\nprint (upload.content)\n\nprint (\"Installing AS3 Extensions...\")\nparams=\"{\\\"operation\\\":\\\"INSTALL\\\",\\\"packageFilePath\\\":\\\"\/var\/config\/rest\/downloads\/as3.rpm\\\"}\"\nheader={\"Origin\": \"https:\/\/@@{svcBigIP.address}@@\",\"Content-Type\": \"application\/json;charset=UTF-8\"}\ninstall = urlreq(\"https:\/\/@@{svcBigIP.address}@@:8443\/mgmt\/shared\/iapp\/package-management-tasks\", verb=\"POST\", headers=header, params=params, auth=\"BASIC\", user=\"@@{admin.username}@@\", passwd=\"@@{admin.secret}@@\")\nprint (install.content)\nprint (\"Ready\")","type":"","command_line_args":"","exit_status":[],"script_type":"static"},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Service1"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Create Runbook Endpoint","attrs":{"exit_status":[],"script":"# script\n\n# modify these if required\ncred_user = \"@@{root.username}@@\"\ntype = \"Linux\"\n\njwt = \"@@{calm_jwt}@@\"\nvm_ip = \"@@{address}@@\"\nblueprint_id = \"@@{calm_blueprint_uuid}@@\"\n\nbase_url = 'https:\/\/127.0.0.1:9440\/api\/nutanix\/v3\/'\n\ndef put_call(api_url, payload):\n  headers = { 'Content-Type' : 'application\/json', 'Accept':'application\/json', 'Authorization': 'Bearer {}'.format(jwt) }\n  r = urlreq(api_url, verb='PUT', params=payload, headers=headers, verify=False)\n  resp = json.loads(r.content)\n  if \"status\" in resp:\n    return resp\n  else:\n    print \"Post request failed\", r.content\n    exit(1)\n    \n\ndef post_call(api_url, payload):\n  headers = { 'Content-Type' : 'application\/json', 'Accept':'application\/json', 'Authorization': 'Bearer {}'.format(jwt) }\n  r = urlreq(api_url, verb='POST', params=payload, headers=headers, verify=False)\n  resp = json.loads(r.content)\n  if \"status\" in resp:\n    return resp\n  else:\n    print \"Post request failed\", r.content\n    exit(1)\n    \n    \ndef get_call(api_url):\n  headers = { 'Authorization': 'Bearer {}'.format(jwt) }\n  r = urlreq(api_url, verb='GET', headers=headers, verify=False)\n  resp = json.loads(r.content)\n  if \"status\" in resp:\n    return resp\n  else:\n    print \"Post request failed\", r.content\n    exit(1)\n\n\napi_url = base_url + \"blueprints\/\" + '@@{calm_blueprint_uuid}@@'\nblueprint = get_call(api_url)\n\nproject_id = blueprint[\"metadata\"][\"project_reference\"][\"uuid\"]\nproject_name = blueprint[\"metadata\"][\"project_reference\"][\"name\"]\n\napi_url = base_url + \"endpoints\/import_json\"\n\nendpoint_json = {\n  \"spec\": {\n    \"name\": \"Endpoint_@@{name}@@\",\n    \"description\": \"Endpoint for vm @@{name}@@\",\n    \"resources\": {\n      \"name\": \"Endpoint_@@{name}@@\",\n      \"type\": type,\n      \"attrs\": {\n        \"values\": [ \"@@{address}@@\" ],\n        \"value_type\": \"IP\",\n        \"port\": 22,\n        \"credential_definition_list\": [\n          {\n            \"name\": \"endpoint_cred\",\n            \"description\": cred_user,\n            \"type\": \"KEY\",\n            \"username\": cred_user,\n            \"secret\": {\n              \"attrs\": {\n                \"is_secret_modified\": False\n              }\n            }\n          }\n        ],\n        \"login_credential_reference\": {\n          \"kind\": \"app_credential\",\n          \"name\": \"endpoint_cred\"\n        }\n      }\n    }\n  },\n  \"metadata\": {\n    \"spec_version\": 1,\n    \"name\": \"Endpoint_@@{name}@@\",\n    \"kind\": \"endpoint\",\n    \"project_reference\": {\n      \"kind\": \"project\",\n      \"uuid\": project_id,\n      \"name\": project_name\n    }\n  },\n  \"api_version\": \"3.0\"\n}\n\nendpoint_return = post_call(api_url, json.dumps(endpoint_json))\n\napi_url = base_url + \"endpoints\/\" + endpoint_return[\"metadata\"][\"uuid\"]\nendpoint = get_call(api_url)\n\ndel endpoint[\"status\"]\nendpoint[\"spec\"][\"resources\"][\"attrs\"][\"credential_definition_list\"][0][\"secret\"][\"value\"] = \"\"\"@@{root.secret}@@\"\"\"\nendpoint[\"spec\"][\"resources\"][\"attrs\"][\"credential_definition_list\"][0][\"secret\"][\"attrs\"][\"is_secret_modified\"] = True \n\nendpoint_update = put_call(api_url, json.dumps(endpoint))\n\nprint \"endpoint_uuid=\"+endpoint_return[\"metadata\"][\"uuid\"]\n\n","eval_variables":["endpoint_uuid"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","type":"SET_VARIABLE","variable_list":[]}],"description":"","name":"4ce46538_runbook","main_task_local_reference":{"kind":"app_task","name":"0a93e741_dag"},"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Package1"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Revoke License"},{"kind":"app_task","name":"Remove Runbook Endpoint"}],"name":"6a2996f5_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Revoke License"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Remove Runbook Endpoint"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Service1"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Revoke License","attrs":{"exit_status":[],"script":"yes | tmsh revoke sys license","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"root"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Service1"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Remove Runbook Endpoint","attrs":{"script":"# script\njwt = \"@@{calm_jwt}@@\"\nvm_ip = \"@@{address}@@\"\nblueprint_id = \"@@{calm_blueprint_uuid}@@\"\n\nbase_url = 'https:\/\/127.0.0.1:9440\/api\/nutanix\/v3\/'\n  \ndef delete_call(api_url):\n  headers = { 'Authorization': 'Bearer {}'.format(jwt) }\n  r = urlreq(api_url, verb='DELETE', headers=headers, verify=False)\n  resp = json.loads(r.content)\n  return resp\n\napi_url = base_url + \"endpoints\/@@{endpoint_uuid}@@\"\ndelete_call(api_url)","type":"","command_line_args":"","exit_status":[],"script_type":"static"},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"ef1255ed_runbook","main_task_local_reference":{"kind":"app_task","name":"6a2996f5_dag"},"variable_list":[]}},"variable_list":[]}],"app_profile_list":[{"deployment_create_list":[{"type":"GREENFIELD","action_list":[],"name":"2d1bb7e1_deployment","min_replicas":"1","default_replicas":"1","depends_on_list":[],"published_service_local_reference_list":[],"max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"Package1"}],"substrate_local_reference":{"kind":"app_substrate","name":"svcBigIP"},"variable_list":[],"description":""}],"environment_reference_list":[],"description":"","action_list":[],"name":"Default","variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"Trial license available at: https:\/\/www.f5.com\/trials\/big-ip-virtual-edition\nLicense will be revoked if Application is deleted","data_type":"BASE","type":"LOCAL","name":"License","value":"","label":"License Key","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"Find Releases under: https:\/\/github.com\/F5Networks\/f5-appsvcs-extension\/releases","data_type":"BASE","type":"LOCAL","name":"AS3","value":"https:\/\/github.com\/F5Networks\/f5-appsvcs-extension\/releases\/download\/v3.22.1\/f5-appsvcs-3.22.1-1.noarch.rpm","label":"AS3 Extension Download Link","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}}]}],"published_service_definition_list":[],"default_credential_local_reference":{"kind":"app_credential","name":"root"},"type":"USER"},"name":"f5 BigIP LoadBalancer"},"api_version":"3.0","metadata":{"last_update_time":"1613666258475671","kind":"blueprint","spec_version":3,"creation_time":"1610622568866071","categories":{"TemplateType":"Vm"},"name":"f5 BigIP LoadBalancer"}}